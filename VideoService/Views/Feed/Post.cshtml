
<!--ТУТ ВСЕ ОК-->

@model Post
@{
    ViewBag.Title = Model.Title;
    ViewBag.Description = Model.Description;
    <!--Если поле Tags? означает что оно потенциально = null, а если Tag!= null, то применяем Replace-->
    ViewBag.Keywords = $"{Model.Tags?.Replace(",", " ")} {Model.Category}";
    var base_path = Context.Request.PathBase;
}

<link href="~/css/Post.css" rel="stylesheet"/>

<div class="post">
    <div class="main-image">
        @if (!String.IsNullOrEmpty(Model.Image))
        {
            //var image_path = $"/Image/{Model.Image}";
            var image_path = $"{base_path}/Image/{Model.Image}";
            <img src="@image_path" />
            <span class="title">@Model.Title</span>
        }
    </div>

    <div class="text-section">
        @Html.Raw(Model.Body) <!--Отображаем тело записи из БД под фото-->
    </div>

    @if (User.Identity.IsAuthenticated)
    {
    // Если пользователь авторизовался, то он может создать комментарий
        <div class="comments-section">
            @{

                // Подгружаем MainComment.cshtml
                await Html.RenderPartialAsync("MainComment",
                    new CommentViewModel { PostId = Model.Id, MainCommentId = 0 });
            }
            @foreach (var c in Model.MainComments)
            {
                
                <div class="comment">
                <label>
                    Author`s name --- @c.Created
                </label>
                    <div class="comment-text">
                        @c.Message
                        
                        <span class="dots" id="dots(@c.Id)">...</span>
                        @*<span class="dots" id=@"dots"+c.Id>...</span>*@
                        <span class="moreText" id="moreText(@c.Id)">MORE text aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span>
                        <span class="readMoreBut" id="readMoreBut(@c.Id)" onclick="ReadMoreOrLess(@c.Id)">Читать далее...</span>
                    </div>
                    
                    @*
                    @{
                        await Html.RenderPartialAsync("MainComment",
                            new CommentViewModel { PostId = Model.Id, MainCommentId = c.Id });
                    }*@
                </div>
                //<div class="subcomment" style="margin-left: 30px;">
                //    @foreach (var sc in c.SubComments)
                //    {
                //        <p>
                //            @sc.Message --- @sc.Created
                //        </p>
                //    }
                //</div>
            }

        </div>
    }
    else
    {
        <div>
            <a asp-action="Login" asp-controller="Auth">Авторизироваться</a>, чтобы оставить комментарий
        </div>
    }
</div>

<script src="~/js/Post.js"></script>